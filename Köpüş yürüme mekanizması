#include <SoftwareSerial.h>
#include <Servo.h>

// Motor Kontrol Pinleri
#define ENA 10
#define IN1 9
#define IN2 8

#define SERVO_PIN 11   // ⭐ Servo pini

SoftwareSerial BTSerial(2, 3); // RX, TX
Servo direksiyon;              // ⭐ Servo

int motorDurum = 0;
int motorHiz = 150;

// Servo açıları
int servoOrta = 90;
int servoSol  = 45;
int servoSag  = 135;

void setup() {
    pinMode(ENA, OUTPUT);
    pinMode(IN1, OUTPUT);
    pinMode(IN2, OUTPUT);

    direksiyon.attach(SERVO_PIN);     // ⭐ Servo başlat
    direksiyon.write(servoOrta);      // ⭐ Ortada başlasın

    Serial.begin(9600);
    BTSerial.begin(9600);
}

void loop() {
    if (BTSerial.available()) {
        char command = BTSerial.read();
        command = toupper(command);

        Serial.print("Gelen: ");
        Serial.println(command);

        switch(command) {

            case 'F':
                motorDurum = 1;
                direksiyon.write(servoOrta);
                break;

            case 'B':
                motorDurum = 2;
                direksiyon.write(servoOrta);
                break;

            case 'S':
                motorDurum = 0;
                break;

            case 'R':   // ⭐ SERVO SAĞ
                direksiyon.write(servoSag);
                break;

            case 'L':   // ⭐ SERVO SOL
                direksiyon.write(servoSol);
                break;

            case 'C':   // ⭐ SERVO ORTA
                direksiyon.write(servoOrta);
                break;

            case '1': motorHiz = 25; break;
            case '2': motorHiz = 50; break;
            case '3': motorHiz = 75; break;
            case '4': motorHiz = 100; break;
            case '5': motorHiz = 125; break;
            case '6': motorHiz = 150; break;
            case '7': motorHiz = 175; break;
            case '8': motorHiz = 200; break;
            case '9': motorHiz = 255; break;
        }
    }

    if (motorDurum == 1) {        // İLERİ
        digitalWrite(IN1, HIGH);
        digitalWrite(IN2, LOW);
        analogWrite(ENA, motorHiz);
    }
    else if (motorDurum == 2) {   // GERİ
        digitalWrite(IN1, LOW);
        digitalWrite(IN2, HIGH);
        analogWrite(ENA, motorHiz);
    }
    else {                        // DUR
        digitalWrite(IN1, LOW);
        digitalWrite(IN2, LOW);
        analogWrite(ENA, 0);
    }
}
